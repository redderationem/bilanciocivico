{#
Â© Copyright 2016 Associazione di promozione sociale Redde Rationem

This file was authored by:

- Gianmarco Tuccini <gianmarcotuccini@redderationem.org>
- Paolo Landi <paololandi@redderationem.org>
- Marco Santini <marcosantini@redderationem.org>

This file is part of BilancioCivico.

BilancioCivico is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

BilancioCivico is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with BilancioCivico.  If not, see <http://www.gnu.org/licenses/>.

Supplemental term under GNU Affero General Public License version 3 section 7

You must retain the whole attribution (both the copyright line and the actual authors' list)
#}
{% extends 'customizations.html' %}
{% import _self as self %}
{% import 'macros.html' as macros %}
{% macro subdivision(by, cycleCode, rows) %}
{% import _self as self %}
{% import 'macros.html' as macros %}
<ul class="list">
	{% for v in rows %}
	<li>
		<a href="{{ cycleCode }}/capitoli/{{ v.code }}.html">{{ v.description }}</a>
		<div class="sparkline">
			<div style="width: {{ v.amountPercent }}%"></div>
			<div style="width: {{ v.usedAmountPercent }}%"></div>
		</div>
		<div class="details">
			<input id="subdivision{{ v.id }}" type="checkbox"/>
			<label for="subdivision{{ v.id }}">
				{% if by == 'amount' %}
				{{ macros.toAmount(v.amount) }}
				{% elseif by == 'code' %}
				{{ v.code }}
				{% elseif by == 'description' %}
				{{ v.description }}
				{% elseif by == 'usedAmount' %}
				{{ macros.toAmount(v.usedAmount) }}
				{% endif %}
			</label>
			<dl>
				<dt>Codice</dt>
				<dd>{{ v.code }}</dd>
				<dt>Descrizione</dt>
				<dd>{{ v.description }}</dd>
				<dt>Totale</dt>
				<dd>{{ macros.toAmount(v.usedAmount) }}</dd>
				<dt>Totale preventivato</dt>
				<dd>{{ macros.toAmount(v.amount) }}</dd>
				<dt>Atti</dt>
				<dd><a href="{{ cycleCode }}/atti.html?match=subdivisions: {{ v.code }}">Cerca</a></dd>
				<dt>Operazioni</dt>
				<dd><a href="{{ cycleCode }}/operazioni.html?match=subdivisions: {{ v.code }}">Cerca</a></dd>
				{% if v.divisionId %}
				<dt>Sezione</dt>
				<dd><a href="{{ cycleCode }}/sezioni/{{ v.divisionCode }}.html">{{ v.divisionDescription }}</a></dd>
				{% endif %}
				<dt>Soggetti</dt>
				<dd><a href="{{ cycleCode }}/soggetti.html?match=subdivisions: {{ v.code }}">Cerca</a></dd>
			</dl>
		</div>
		{% if v.rows %}
		<div class="details">
			<input id="subdivisions{{ v.id }}" type="checkbox"/>
			<label for="subdivisions{{ v.id }}">Mostra i sottocapitoli</label>
			{{ self.subdivision(by, cycleCode, v.rows) }}
		</div>
		{% endif %}		
	</li>
	{% endfor %}
</ul>
{% endmacro %}
{% set pageTitle %}{{ cycleCode }} / Capitoli{% endset %}
{% block header %}
<h1>{{ cycleCode }} / Capitoli</h1>
{{ parent() }}
<div class="navigation secondary {{ match ? 'highlighted' : '' }}">
	<form>
		<input name="by" type="hidden" value="{{ by }}"/>
		<input name="direction" type="hidden" value="{{ direction }}"/>
		<input name="limit" type="hidden" value="{{ limit }}"/>
		<input name="offset" type="hidden" value="{{ offset }}"/>
		<input name="operator" type="hidden" value="{{ operator }}"/>
		<label><input name="match" placeholder="Cosa cerchi?" value="{{ match }}"/></label>
		<button type="submit">Cerca</button>
	</form>
	<ul>
		<li><a href="{{ cycleCode }}/operazioni.html?match={{ match }}&operator={{ operator }}">Operazioni</a></li>
		<li><strong>Capitoli</strong></li>
		<li><a href="{{ cycleCode }}/sezioni.html?match={{ match }}&operator={{ operator }}">Sezioni</a></li>
		<li><a href="{{ cycleCode }}/atti.html?match={{ match }}&operator={{ operator }}">Atti</a></li>
		<li><a href="{{ cycleCode }}/soggetti.html?match={{ match }}&operator={{ operator }}">Soggetti</a></li>
	</ul>
</div>
{% endblock %}
{% block body %}
<div class="main">
	<div class="section">
		{% if match %}
		<h2>Capitoli trovati</h2>
		{% else %}
		<h2>Tutti i capitoli</h2>
		{% endif %}
		{% if subdivisions.count %}
		<p>{{ subdivisions.count }} {{ macros.toCountable(subdivisions.count, 'capitolo', 'capitoli') }} ({{ macros.toAmount(subdivisions.usedAmount) }} di {{ macros.toAmount(subdivisions.amount) }} {{ macros.toCountable(subdivisions.amount, 'preventivato', 'preventivati') }})</p>
		{{ self.subdivision(by, cycleCode, subdivisions.rows) }}
		{% else %}
		<p>Nessun capitolo</p>
		{% endif %}
	</div>
</div>
<div class="aside">
	<div class="section">
		<h2>Preferenze</h2>
		<h3>Quale parte ti interessa?</h3>
		<ul class="menu inline">
			<li>
				{% if operator == '>' %}
				<strong>Le entrate</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': by, 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': '>'}|url_encode }}">Le entrate</a>
				{% endif %}
			</li>
			<li>
				{% if operator == '<' %}
				<strong>Le spese</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': by, 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': '<'}|url_encode }}">Le spese</a>
				{% endif %}
			</li>
		</ul>
		<h3>Per cosa vuoi ordinare i risultati?</h3>
		<ul class="menu inline">
			<li>
				{% if by == 'code' %}
				<strong>Per codice</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': 'code', 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Per codice</a>
				{% endif %}
			</li>
			<li>
				{% if by == 'description' %}
				<strong>Per descrizione</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': 'description', 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Per descrizione</a>
				{% endif %}
			</li>
			<li>
				{% if by == 'usedAmount' %}
				<strong>Per totale</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': 'usedAmount', 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Per totale</a>
				{% endif %}
			</li>
			<li>
				{% if by == 'amount' %}
				<strong>Per totale preventivato</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': 'amount', 'direction': direction, 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Per totale preventivato</a>
				{% endif %}
			</li>
		</ul>
		<h3>In quale verso?</h3>
		<ul class="menu inline">
			<li>
				{% if direction == 'ASC' %}
				<strong>Crescente</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': by, 'direction': 'ASC', 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Crescente</a>
				{% endif %}
			</li>
			<li>
				{% if direction == 'DESC' %}
				<strong>Decrescente</strong>
				{% else %}
				<a href="{{ cycleCode }}/capitoli.html?{{ {'by': by, 'direction': 'DESC', 'limit': limit, 'match': match, 'offset': 0, 'operator': operator}|url_encode }}">Decrescente</a>
				{% endif %}
			</li>
		</ul>
	</div>
</div>
{% endblock %}